###### 0、TCP握手
###### 1、TCP三次握手
> 1. 客户端主动发送一个连接请求，SYN=1, seq=x，并将数据包发送给服务端， 进入syn send状态，等待服务端确认

> 2. 服务端被动接受到客服端的请求后，通过SYN=1得知是请求建立连接，SYN=1, ACK=1, seq=y, ack=x+1，并将数据包发送给客户端以确认连接请求，进入SYN RECV状态

> 3. 客户端收到服务端的确认后，检查ACK是否为1，ack是否为x+1，如果正确，ACK=1, ack=y+1，并将数据包发送给服务端，服务端检查ACK是否为1，ack是否为y+1，如果正确则连接建立成功，两端都进入establish状态，可以开始传输数据了

> 字段解释

> 1. seq：序列号，占32位
> 2. SYN：标识位，1为建立一个新连接
> 3. ACK：标识位，确认，1代表确认序号正确
> 4. ack：确认序列号，在确认序列号正确后，ACK=1，ack=seq+1
> 5. FIN：标识位，释放一个连接
> 6. PSH：标志位，接受方应尽快把这个报文交给应用成
> 7. RST：标志位，重置连接

###### 2、TCP四次挥手
> 1. 其中一方发送FIN序列号给另外一方，表示己方请求关闭连接，不再发送数据包，进入fin wait 状态

> 2. 对方收到FIN之后，ACK=1，ack=FIN+1，确认关闭连接，进入close wait状态

> 3. 对方执行完其他工作后，发送一个FIN回来，进入last ACK状态

> 4. 己方收到FIN之后，发送ACK=1，ack=FIN+1，确认关闭连接，进入time wait状态，对方接到数据包之后，检查后确认正确进入closed状态


###### 3、可能的面试题

> 1. 问：为什么Tcp连接是三次，挥手是四次

> 答1：
> 在Tcp连接中，服务端的SYN和ACK向客户端发送是一次性发送的，而在断开连接的过程中，B端向A端发送的ACK和FIN是分两次发送的。因为在B端接收到A端的FIN后，B端可能还有数据要传输，所以先发送ACK，等B端处理完自己的事情后就可以发送FIN断开连接了。


> 答2：
> 这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。

> 2. 问：三次握手是什么或者流程？四次挥手/握手呢？答案前面分析就是。